{% extends 'base.html' %}
{% block content %}
<h1>Upload & Encrypt</h1>
<form id="upload-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="file" required>
    <input type="password" name="password" placeholder="Password to decrypt" required>
    <button type="submit">Encrypt & generate link</button>
</form>

<div id="result" class="card" style="display:none;"></div>

<script>
const form = document.getElementById('upload-form');
const resultBox = document.getElementById('result');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const response = await fetch("{% url 'upload' %}", {
        method: 'POST',
        body: formData
    });
    const data = await response.json();
    resultBox.style.display = 'block';
    resultBox.innerHTML = `
        <p>Share link:</p>
        <div class="link-box">${window.location.origin}${data.share_link}</div>
        <p>Password: <strong>${data.password}</strong></p>
    `;
});
</script>
{% endblock %}
